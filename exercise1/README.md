## JVM Builds with Gradle Build Tool - Exercise 1

<p align="left">
<img width="10%" height="10%" src="https://user-images.githubusercontent.com/120980/174325546-8558160b-7f16-42cb-af0f-511849f22ebc.png">
</p>

This is a hands-on exercise to go along with the
**JVM Builds with Gradle Build Tool** training module. In this exercise
you will get familiar with the following topics:

* Modifying SourceSet directories
* Using SourceSet outputs
* Creating SourceSets
* Exploring SourceSet tasks

---
### Prerequisites

* JDK 1.8+ and Gradle build tool installed
    * https://gradle.org/install/
* IntelliJ IDE - Optional but recommended
    * https://www.jetbrains.com/idea/download/

### Picking a Language for the Exercises

The lab has different subprojects for the following JVM languages:

* Java
* Groovy
* Kotlin
* Scala

You can pick which subproject you want to work with for the exercises,
or if you have time you can do the exercises with more than one subproject.
Most of the changes you make will be in the
`buildSrc/src/main/kotlin/shared-build-conventions.gradle.kts` file - take
a moment to get familiar with this file.

The exercises will refer to locations such as
`<subproject>/src/main/java/com/gradle/lab/<source>`. The `<subproject>` will
be the directory of the subproject you decide to work with, and the `<source>`
will be the source file(s) there.

---
### Code Generation Task

Open the Gradle project in the `lab` folder. In IntelliJ you can do this by
opening the `settings.gradle.kts` file as a Gradle project.

Inspect the `<subproject>/src/main/java/com/gradle/lab/<source>` file. You
will notice it depends on a `Message` class which isn't found. This class
exists in `mlCodeGenTemplate/com/gradle/lab/Message.java`. For the purposes
of this  exercise let's pretend that this file is going to be edited and
partially generated by a machine learning tool. Let's create the task that
will then output the final source file for our consumption.

Add the following task to
`buildSrc/src/main/kotlin/shared-build-conventions.gradle.kts`:

```kotlin
tasks.register<Copy>("generateMlCode") {
    from(layout.projectDirectory.dir("../mlCodeGenTemplate"))
    into(layout.buildDirectory.dir("generated/sources/mlCode"))
}
```

This will create a task that will "generate" the required source files
and make them available in the `build` directory for use.

**Note** that it is recommended that any artifacts produced during the build
including generated sources are put in the `build` directory.

### Updating the `main` SourceSet

To view the current configuration of the `main` SourceSet run:

```bash
./gradlew :<subproject>:sourceSetsInfo
```

Notice the srcDirs for the `main` SourceSet.

We need to register the generated sources to make them available
to the rest of the sources. To do this, edit
`buildSrc/src/main/kotlin/shared-build-conventions.gradle.kts`
and add configuration to include the outputs of the `generateMlCode` task
as part of the main SourceSet.

```kotlin
sourceSets {
    main {
        java {
            // Make your changes here.
        }
    }
}
```

*Hint:* You want to reference the *task named* `generateMlCode`.

For hints you can refer to the following documentation:
* [Adding entires to SourceSets](https://docs.gradle.org/current/userguide/building_java_projects.html#sec:custom_java_source_set_paths)
* [Linking outputs to inputs](https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:link_output_dir_to_input_files)

If you get stuck you can refer to the solution.

Now when you inspect the `main` SourceSet you will see the additional generated
sources:

```bash
./gradlew :<subproject>:sourceSetsInfo
```

After you have successfully done this Gradle will be able to use the additional
sources and compile tasks will succeed and you can run the application.

```bash
./gradlew :<subproject>:run
```

### Creating a New SourceSet

Inspect the source files under `<subproject>/src/extra`. Let's create a
SourceSet for these. Use the `sourceSets.create` method to register a
new SourceSet. Assign this SourceSet to a variable.

```kotlin
val extraSrc = ...
```

Now if you inspect the SourceSets you will see this new one show up:

```bash
./gradlew :<subproject>:sourceSetsInfo
```

### Adding a Task for the new SourceSet

You can compile the new SourceSet by running the `compileExtraJava`
task:

```bash
./gradlew :java:compileExtraJava
```

Let's add a task to run the new sources which has a main class.
Register a new task of type `JavaExec` and set the classpath
and main class.

*Hint:* The classpath will be the output of the `extraSrc` SourceSet.

```kotlin
tasks.register... {
    classpath = ...
    mainClass.set(...)
}
```

You can now run the source for the new SourceSet:

```bash
./gradlew :java:runExtra
```
